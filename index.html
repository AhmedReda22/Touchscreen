<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Sharpen Your Mind!</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
  <style>
    /* ========== GENERAL STYLES ========== */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f4f4;
      text-align: center;
      color: #333;
      overflow: hidden;
      height: 100vh;
    }

    /* ========== HOLDING PAGE ========== */
    #holding-page {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: space-between;
      height: 100vh;
      width: 100vw;
      color: white;
      position: relative;
      overflow: hidden;
      padding: 2vh 20px;
    }

    /* إضافة الفيديو كخلفية */
    #holding-page::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('./imgs/8.png'); /* صورة احتياطية */
      background-size: cover;
      background-position: center;
      z-index: -2;
    }

    #bg-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .top-content {
      width: 100%;
      display: flex;
      flex-direction: column;
      align-items: center;
      z-index: 10;
      flex-shrink: 0;
      margin-top: 50px;
    }

    .top-content h1 {
      font-size: clamp(2rem, 5vw, 3.5rem);
      font-weight: 900;
      color: #ffc900;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      margin-bottom: 1vh;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .top-content p {
      font-size: clamp(1rem, 2.5vw, 1.5rem);
      font-weight: 500;
      color: white;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      max-width: 1200px;
      min-height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* التعديلات الجديدة: إزالة فقاعة الكلام وتكبير الروبوت */
    .character-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      height: 40vh; /* زيادة الارتفاع لاستيعاب الروبوت الأكبر */
      flex-shrink: 0;
    }

    .robot-character {
      width: clamp(150px, 25vw, 250px);
      height: clamp(150px, 25vw, 250px);
      background-image: url('./imgs/charachter.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      animation: robotMove 2.5s ease-in-out infinite;
      flex-shrink: 0;
    }

    @keyframes robotMove {
      0% { transform: translateY(0) rotate(0deg); }
      25% { transform: translateY(-3px) rotate(1deg); }
      50% { transform: translateY(0) rotate(-1deg); }
      75% { transform: translateY(3px) rotate(0.5deg); }
      100% { transform: translateY(0) rotate(0deg); }
    }

    .quiz-page .robot-character{
      animation: robotMove 2.5s ease-in-out infinite;
    }
    .lang-buttons {
      width: 100%;
      display: flex;
      justify-content: center;
      gap: clamp(20px, 5vw, 50px);
      z-index: 10;
      flex-shrink: 0;
      height: 15vh;
      align-items: center;
      margin-bottom: 50px;
    }

    .lang-buttons button {
      background-image: url('./imgs/1.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-color: transparent;
      color: white; /* أزرق داكن */
      font-weight: 800;
      font-size: clamp(1.5rem, 4vw, 2.1rem); /* تكبير الخط */
      border: none;
      cursor: pointer;
      transition: transform 0.3s ease;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
      width: clamp(220px, 40vw, 400px); /* تكبير العرض */
      height: clamp(90px, 18vw, 160px); /* تكبير الارتفاع */
      display: flex;
      align-items: center;
      justify-content: center;
      filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3)); /* إضافة ظل إضافي */
    }

    .lang-buttons button:hover {
      transform: scale(1.05);
    }

    /* ========== KNOWLEDGE PAGE ========== */
    #knowledge-page {
      display: none;
      flex-direction: column;
      height: 100vh;
      color: white;
      padding: 2vh 20px;
      position: relative;
      overflow: hidden;
    }

    /* إضافة الفيديو كخلفية لصفحة المعرفة */
    #knowledge-page::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url('./imgs/8.png'); /* صورة احتياطية */
      background-size: cover;
      background-position: center;
      z-index: -2;
    }

    #knowledge-bg-video {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: -1;
    }

    .knowledge-content {
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: center;
      align-items: center;
      gap: 2rem;
    }

    /* إعادة إضافة فقاعة الكلام لصفحة المعرفة */
    .character-speech-container {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      gap: 20px;
      flex-shrink: 0;
      height: 30vh;
    }

    .character-speech-container.knowledge {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      position: relative;
      gap: 20px;
      flex-shrink: 0;
      height: 30vh;
      margin-top: 65px;
    }

    .speech-bubble-container {
      width: 650PX;
      background-image: url('./imgs/2.png');
      background-size: 100% 110%;
      background-repeat: no-repeat;
      background-position: center;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: clamp(80px, 15vw, 150px) clamp(30px, 8vw, 120px);
      z-index: 9;
      flex-shrink: 0;
      margin: 0 clamp(20px, 5vw, 40px);
    }

    .speech-bubble-container p {
      color: #45312c;
      font-weight: 800;
      font-size: clamp(0.9rem, 2vw, 1.6rem);
      line-height: 1.5;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topics-section {
      padding: 0 1rem;
      width: 100%;
      max-width: 1400px;
      margin: 0 auto;
      flex-grow: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-height: 60vh;
      overflow-y: auto;
      padding: 10px;
    }

    .topic-card {
      background-color: rgba(64, 120, 120, 0.8);
      border-radius: 1.5rem;
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      min-height: 200px;
    }

    .topic-card:hover {
      transform: scale(1.05);
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .topic-card.selected {
      box-shadow: 0 0 0 4px #fbbf24, 0 15px 40px rgba(0, 0, 0, 0.3);
    }

    .topic-icon {
      width: clamp(80px, 15vw, 150px);
      height: clamp(80px, 15vw, 150px);
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .topic-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      animation: zoomInOut 3s ease-in-out infinite;
    }

    .topic-title {
      font-size: clamp(1rem, 2vw, 1.3rem);
      font-weight: bold;
      text-align: center;
    }

    /* ========== زر العودة وزر الصفحة الرئيسية ========== */
    .navigation-buttons {
      position: fixed;
      bottom: 1.5rem;
      left: 1.5rem;
      display: flex;
      gap: 1rem;
      z-index: 10;
    }

    .home-button, .main-home-button {
      width: clamp(4rem, 8vw, 5rem);
      height: clamp(4rem, 8vw, 5rem);
      border-radius: 50%;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
      transition: all 0.2s ease;
      background: transparent;
      padding: 0;
    }

    .home-button img, .main-home-button img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      border-radius: 50%;
    }

    .home-button:hover, .main-home-button:hover {
      transform: scale(1.1);
    }

    /* ========== QUIZ PAGES ========== */
    .quiz-page {
      display: none;
      flex-direction: column;
      height: 100vh;
      color: white;
      padding: 2vh 20px;
      position: relative;
      overflow: hidden;
    }

    .quiz-content {
      display: flex;
      flex-direction: column;
      height: 100%;
      justify-content: space-between;
    }

    /* التعديلات المطلوبة: جعل quiz-header يكون position: relative */
    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 1rem;
      flex-shrink: 0;
      height: 15vh;
      flex-direction: row;
      gap: 10px;
      margin-top: 40px; /* غيري من 90px إلى 40px */
      position: relative;
    }

    .quiz-title {
      font-size: clamp(1.5rem, 4vw, 2.5rem);
      font-weight: 800;
      color: #ffc900;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      text-align: center;
      flex: 1;
      order: 1;
      /* العنوان يبقى في المنتصف */
    }

    /* التعديلات المطلوبة: جعل الأيقونة في أعلى اليمين */
    .quiz-icon {
      width: clamp(100px, 20vw, 180px); /* تكبير من 80px إلى 100px */
      height: clamp(100px, 20vw, 180px); /* تكبير من 80px إلى 100px */
      animation: zoomInOut 3s ease-in-out infinite;
      flex-shrink: 0;
      order: 2;
      position: relative;
      top: 0;
      right: 0;
      margin: 10px;
    }

    /* أيقونة العداد الجديدة */
    .countdown-icon {
      width: clamp(100px, 20vw, 250px); /* تكبير من 80px إلى 100px */
      height: clamp(100px, 20vw, 250px); /* تكبير من 80px إلى 100px */
      flex-shrink: 0;
      order: 0;
      position: relative;
      top: 0;
      left: 0;
      margin: 10px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    /* مؤقت العد التنازلي */
    .countdown-timer {
      font-size: clamp(1.5rem, 3vw, 2.5rem);
      font-weight: 800;
      color: #ffc900;
      text-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 50%;
      width: clamp(70px, 12vw, 100px);
      height: clamp(70px, 12vw, 100px);
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 10px auto 0;
      border: 3px solid #ffc900;
    }

    .countdown-timer.warning {
      color: #ff4444;
      border-color: #ff4444;
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }

    .quiz-icon img, .countdown-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    /* أنيميشن الزووم */
    @keyframes zoomInOut {
      0% { transform: scale(1); }
      50% { transform: scale(1.15); }
      100% { transform: scale(1); }
    }

    /* التعديلات المطلوبة: جعل العناصر تنزل لأسفل في الصفحات التعليمية */
    #math-questions-page .character-speech-container.quiz,
    #nature-questions-page .character-speech-container.quiz,
    #uzbekistan-questions-page .character-speech-container.quiz,
    #ancestors-questions-page .character-speech-container.quiz {
      display: flex;
      align-items: center;
      justify-content: center; 
      height: 20vh;
      margin: 0 auto;
      flex-shrink: 0;
      width: 100%;
      max-width: 1200px; 
    }

    #math-questions-page .question-container,
    #nature-questions-page .question-container,
    #uzbekistan-questions-page .question-container,
    #ancestors-questions-page .question-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      flex-grow: 1;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 1rem;
      margin-top: 4rem; /* إضافة مسافة من الأعلى */
    }

    .options-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      width: 100%;
      max-width: 1200px;
    }

    .option-button {
      background-image: url('./imgs/7.png');
      background-size: 100% 100%;
      background-repeat: no-repeat;
      background-position: center;
      background-color: transparent;
      color: #45312C;
      font-weight: 700;
      font-size: clamp(1.2rem, 2.5vw, 2.2rem);
      border: none;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 100%;
      height: clamp(100px, 15vw, 150px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1.5rem;
      border-radius: 15px;
      word-wrap: break-word;
      overflow-wrap: break-word;
      word-break: break-word;
      hyphens: auto;
      text-align: center;
      line-height: 1.3;
    }

    .option-button:hover {
      transform: scale(1.08);
    }

    /* التغييرات الجديدة للإجابات الصحيحة والخاطئة */
    .option-button.correct {
      background-image: url('./imgs/green-button.png');
    }

    .option-button.incorrect {
      background-image: url('./imgs/red-button.png');
    }

    /* فئات جديدة لضبط حجم الخط للنصوص الطويلة */
    .option-button.medium-text {
      font-size: clamp(1rem, 2vw, 1.8rem);
    }

    .option-button.small-text {
      font-size: clamp(0.8rem, 1.8vw, 1.5rem);
    }

    .option-button.very-small-text {
      font-size: clamp(0.7rem, 1.5vw, 1.2rem);
    }

    .progress-container {
      width: 100%;
      max-width: 800px;
      margin: 1rem auto;
      background-color: rgba(255, 255, 255, 0.2);
      border-radius: 10px;
      height: 20px;
      overflow: hidden;
      flex-shrink: 0;
    }

    .progress-bar {
      height: 100%;
      background-color: #ffc900;
      width: 0%;
      transition: width 0.5s ease;
    }

    .result-container {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      max-width: 800px;
      background-color: rgba(255, 255, 255, 0.1);
      border-radius: 20px;
      padding: 2rem;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
      width: 90%;
      flex-grow: 1;
    }

    .result-title {
      font-size: clamp(1.8rem, 4vw, 2.5rem);
      color: #ffc900;
      margin-bottom: 1.5rem;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.5);
    }

    .result-score {
      font-size: clamp(2rem, 5vw, 3rem);
      font-weight: 800;
      color: white;
      margin-bottom: 1.5rem;
    }

    .result-message {
      font-size: clamp(1.2rem, 2.5vw, 1.5rem);
      color: white;
      margin-bottom: 2rem;
      text-align: center;
      line-height: 1.6;
    }

    .restart-button {
      background-image: url('./imgs/7.png');
      background-size: cover;
      background-repeat: no-repeat;
      background-position: center;
      background-color: transparent;
      color: white;
      font-weight: 700;
      font-size: clamp(1.2rem, 2.5vw, 1.8rem);
      border: none;
      cursor: pointer;
      transition: transform 0.3s ease;
      text-shadow: 0 2px 5px rgba(0, 0, 0, 0.8);
      width: clamp(180px, 30vw, 250px);
      height: clamp(70px, 12vw, 100px);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 1rem;
      border-radius: 15px;
      margin-top: 1rem;
    }

    .restart-button:hover {
      transform: scale(1.05);
    }

    /* ========== ANIMATIONS FOR QUESTIONS AND ANSWERS ========== */
    /* أنيميشن السؤال ينزل من أعلى الشاشة */
    /* تم إزالة الأنيميشن من character-speech-container.quiz ليظل الروبوت ثابتاً */
    .character-speech-container.quiz {
      /* إزالة الخصائص التي تسبب الحركة للروبوت */
      opacity: 1; /* يجب أن يكون مرئياً */
      transform: translateY(0); /* يجب أن يكون ثابتاً */
    }

    .character-speech-container.quiz .speech-bubble-container {
      animation: slideDownQuestion 0.5s ease-out forwards;
      opacity: 0;
      transform: translateY(-100vh);
    }

    @keyframes slideDownQuestion {
      0% {
        opacity: 0;
        transform: translateY(-100vh);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* أنيميشن الإجابات تظهر من أسفل الشاشة */
    .question-container {
      animation: slideUpAnswers 0.5s ease-out forwards;
      opacity: 0;
      transform: translateY(100vh);
      animation-delay: 0.3s;
    }

    @keyframes slideUpAnswers {
      0% {
        opacity: 0;
        transform: translateY(100vh);
      }
      100% {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* ========== التعديلات الجديدة ========== */
    /* أنيميشن اختفاء السؤال للأعلى */
    .character-speech-container.quiz.exit .speech-bubble-container {
      animation: slideUpQuestion 0.5s ease-in forwards;
    }

    @keyframes slideUpQuestion {
      0% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(-100vh);
      }
    }

    /* أنيميشن اختفاء الإجابات للأسفل */
    .question-container.exit {
      animation: slideDownAnswers 0.5s ease-in forwards;
    }

    @keyframes slideDownAnswers {
      0% {
        opacity: 1;
        transform: translateY(0);
      }
      100% {
        opacity: 0;
        transform: translateY(100vh);
      }
    }

    /* ========== أيقونات الإجابات الصحيحة والخاطئة ========== */
    .answer-icon {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) scale(0);
      width: clamp(200px, 40vw, 400px);
      height: clamp(200px, 40vw, 400px);
      z-index: 1000;
      display: none;
      animation: popIn 0.5s ease-out forwards;
    }

    .answer-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    @keyframes popIn {
      0% {
        transform: translate(-50%, -50%) scale(0);
        opacity: 0;
      }
      70% {
        transform: translate(-50%, -50%) scale(1.2);
        opacity: 1;
      }
      100% {
        transform: translate(-50%, -50%) scale(1);
        opacity: 1;
      }
    }

    /* ========== MEDIA QUERIES ========== */
    @media (max-width: 1200px) {
      .options-container {
        max-width: 900px;
      }
    }

    @media (max-width: 992px) {
      .character-speech-container {
        flex-direction: column;
        gap: 10px;
        height: 25vh;
      }
      
      .speech-bubble-container {
        max-width: 90%;
      }
      
      .quiz-header {
        justify-content: center;
        text-align: center;
        flex-direction: column;
        height: 20vh;
        gap: 10px;
      }
      
      .quiz-title {
        text-align: center;
      }
    }

    @media (max-width: 768px) {
      .character-container {
        height: 35vh;
      }
      
      .topics-grid {
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1rem;
      }
      
      .topic-card {
        min-height: 180px;
        padding: 1rem;
      }
      
      .options-container {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
      }
      
      .navigation-buttons {
        bottom: 1rem;
        left: 1rem;
        gap: 0.8rem;
      }
      
      .lang-buttons {
        flex-wrap: wrap;
        height: auto;
        padding: 10px 0;
      }
      
      .option-button {
        padding: 1rem;
      }
    }

    @media (max-width: 576px) {
      #holding-page, #knowledge-page, .quiz-page {
        padding: 1vh 10px;
      }
      
      .topics-grid {
        grid-template-columns: 1fr;
      }
      
      .options-container {
        grid-template-columns: 1fr;
      }
      
      .option-button {
        height: 100px;
        padding: 0.8rem;
      }
      
      .quiz-header {
        flex-direction: column;
        height: 25vh;
      }
      
      .result-container {
        padding: 1.5rem;
      }
      
      .character-container {
        height: 40vh;
      }
      
      .navigation-buttons {
        flex-direction: column;
        gap: 0.5rem;
      }
    }

    @media (max-width: 480px) {
      .topic-card {
        min-height: 150px;
      }
      
      .topic-icon {
        width: 80px;
        height: 80px;
      }
      
      .option-button {
        font-size: 1.2rem;
      }
      
      .lang-buttons {
        flex-direction: column;
        gap: 10px;
      }
    }

    /* تحسينات خاصة للشاشات الطويلة */
    @media (max-height: 700px) {
      .top-content h1 {
        margin-bottom: 0.5vh;
      }
      
      .topic-card {
        min-height: 140px;
        padding: 0.8rem;
      }
      
      .topic-icon {
        width: 60px;
        height: 60px;
        margin-bottom: 0.5rem;
      }
      
      .character-container {
        height: 45vh;
      }
      
      .quiz-header {
        height: 18vh;
      }
    }
    
    @media (max-height: 600px) {
      .character-container {
        height: 50vh;
      }
      
      .topics-grid {
        max-height: 50vh;
      }
      
      .quiz-header {
        height: 15vh;
      }
    }

    /* إخفاء فقاعة الكلام في صفحة النتائج */
    #uzbekistan-result-container ~ .character-speech-container.quiz,
    #math-result-container ~ .character-speech-container.quiz,
    #nature-result-container ~ .character-speech-container.quiz,
    #ancestors-result-container ~ .character-speech-container.quiz {
        display: none !important;
    }

    /* إخفاء فقاعة الكلام فقط في صفحة النتائج مع إبقاء الروبوت */
    #math-result-container ~ .character-speech-container.quiz .speech-bubble-container,
    #nature-result-container ~ .character-speech-container.quiz .speech-bubble-container,
    #uzbekistan-result-container ~ .character-speech-container.quiz .speech-bubble-container,
    #ancestors-result-container ~ .character-speech-container.quiz .speech-bubble-container {
        display: none !important;
    }
    
    /* ========== التعديلات الجديدة ========== */
    /* إخفاء العداد وعداد الوقت عند ظهور النتائج */
    .result-container ~ .quiz-header .countdown-icon,
    .result-container ~ .quiz-header .countdown-timer {
        display: none !important;
    }
    
    /* إخفاء فقاعة الكلام بالكامل عند ظهور النتائج */
    .result-container ~ .character-speech-container.quiz .speech-bubble-container {
        display: none !important;
    }
    
    /* إبقاء الروبوت فقط عند ظهور النتائج */
    .result-container ~ .character-speech-container.quiz {
        display: flex !important;
        align-items: center;
        justify-content: center;
    }


    /* ========== تعديلات الروبوت في صفحة النتائج ========== */
.result-container ~ .character-speech-container.quiz {
    position: absolute;
    top: 20px; /* تعديل هذه القيمة لرفع الروبوت أكثر */
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    margin-top: 0;
}

.result-container ~ .character-speech-container.quiz .robot-character {
    width: clamp(100px, 15vw, 180px); /* تصغير حجم الروبوت */
    height: clamp(100px, 15vw, 180px); /* تصغير حجم الروبوت */
}

/* إخفاء الروبوت الإضافي إذا كان موجوداً */
.result-container ~ .character-speech-container.quiz .robot-character:nth-child(2) {
    display: none;
}
  </style>
</head>
<body>

  <!-- HOLDING PAGE -->
  <div id="holding-page">
    <!-- إضافة الفيديو كخلفية -->
    <video id="bg-video" autoplay muted loop playsinline>
      <source src="./imgs/bg.mp4" type="video/mp4">
      <!-- إذا لم يدعم المتصالف الفيديو، سيتم استخدام الصورة الخلفية -->
    </video>
    
    <div class="top-content">
      <h1 id="title-text">SHARPEN YOUR MIND</h1>
      <p id="subtitle-text">ARE YOU READY TO CHALLENGE YOUR BRAIN WITH SOME FUN QUESTIONS?</p>
    </div>

    <!-- التعديل: استبدال حاوية الشخصية والفقاعة بحاوية الروبوت فقط -->
    <div class="character-container">
      <div class="robot-character"></div>
    </div>

    <div class="lang-buttons">
      <button id="boshlash-btn">BOSHLASH</button>
      <button id="nachat-btn">НАЧАТЬ</button>
      <button id="start-btn">START</button>
    </div>
  </div>

  <!-- KNOWLEDGE PAGE -->
  <div id="knowledge-page">
     <video id="knowledge-bg-video" autoplay muted loop playsinline>
    <source src="./imgs/bg.mp4" type="video/mp4">
    <!-- إذا لم يدعم المتصالف الفيديو، سيتم استخدام الصورة الخلفية -->
  </video>
   <div class="knowledge-content">
  <!-- إعادة إضافة فقاعة الكلام لصفحة المعرفة -->
  <div class="character-speech-container knowledge">
    <div class="robot-character"></div>
    <div class="speech-bubble-container">
      <p>Choose a topic to begin your adventure of knowledge!</p>
    </div>
  </div>

      <div class="topics-section">
        <div class="topics-grid">
          <div class="topic-card" onclick="selectTopic(this, 'ancestors')">
            <div class="topic-icon"><img src="./imgs/3.png" alt="Ancestors"></div>
            <div class="topic-title">Great Ancestors</div>
          </div>
          <div class="topic-card" onclick="selectTopic(this, 'uzbekistan')">
            <div class="topic-icon"><img src="./imgs/4.png" alt="Uzbekistan"></div>
            <div class="topic-title">Uzbekistan Knowledge</div>
          </div>
          <div class="topic-card" onclick="selectTopic(this, 'nature')">
            <div class="topic-icon"><img src="./imgs/5.png" alt="Nature"></div>
            <div class="topic-title">Nature & Environment</div>
          </div>
          <div class="topic-card" onclick="selectTopic(this, 'math')">
            <div class="topic-icon"><img src="./imgs/6.png" alt="Math"></div>
            <div class="topic-title">Simple Mathematics</div>
          </div>
        </div>
      </div>
    </div>

    <div class="navigation-buttons">
      <button class="home-button" aria-label="Home" id="home-btn">
        <img src="./imgs/0.png" alt="Home">
      </button>
      <button class="main-home-button" aria-label="Main Home" id="main-home-btn">
        <img src="./imgs/home.png" alt="Main Home">
      </button>
    </div>
  </div>

  <!-- MATH QUESTIONS PAGE -->
  <div id="math-questions-page" class="quiz-page" style="background-image: url('./imgs/9.png'); background-size: cover; background-position: center;">
    <!-- إضافة أيقونات الإجابات الصحيحة والخاطئة -->
    <div class="answer-icon" id="math-correct-icon">
      <img src="./imgs/correct.png" alt="Correct">
    </div>
    <div class="answer-icon" id="math-wrong-icon">
      <img src="./imgs/wrong.png" alt="Wrong">
    </div>
    
    <div class="quiz-content">
      <div class="quiz-header">
        <div class="countdown-icon">
          <img src="./imgs/countdown.gif" alt="Countdown">
          <div class="countdown-timer" id="math-countdown">15</div>
        </div>
        <div class="quiz-title">Simple Mathematics</div>
        <div class="quiz-icon">
          <img src="./imgs/6.png" alt="Math Icon">
        </div>
      </div>

      <!-- إعادة إضافة فقاعة الكلام لصفحة الرياضيات -->
      <div class="character-speech-container quiz">
        <div class="robot-character"></div>
        <div class="speech-bubble-container">
          <p id="math-question-text">What is the largest three-digit number?</p>
        </div>
      </div>

      <div class="question-container">
        <div class="options-container" id="math-options-container">
          <!-- Options will be populated by JavaScript -->
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="math-progress-bar"></div>
      </div>
    </div>

    <div class="result-container" id="math-result-container">
      <div class="result-title" id="math-result-title">Quiz Completed!</div>
      <div class="result-score" id="math-result-score">Score: 0/10</div>
      <div class="result-message" id="math-result-message">Great job! You're a math wizard!</div>
      <button class="restart-button" id="math-restart-button">Try Again</button>
    </div>

    <div class="navigation-buttons">
      <button class="home-button" aria-label="Home" id="math-home-btn">
        <img src="./imgs/0.png" alt="Home">
      </button>
      <button class="main-home-button" aria-label="Main Home" id="math-main-home-btn">
        <img src="./imgs/home.png" alt="Main Home">
      </button>
    </div>
  </div>

  <!-- NATURE QUESTIONS PAGE -->
  <div id="nature-questions-page" class="quiz-page" style="background-image: url('./imgs/10.png'); background-size: cover; background-position: center;">
    <!-- إضافة أيقونات الإجابات الصحيحة والخاطئة -->
    <div class="answer-icon" id="nature-correct-icon">
      <img src="./imgs/correct.png" alt="Correct">
    </div>
    <div class="answer-icon" id="nature-wrong-icon">
      <img src="./imgs/wrong.png" alt="Wrong">
    </div>
    
    <div class="quiz-content">
      <div class="quiz-header">
        <div class="countdown-icon">
          <img src="./imgs/countdown.gif" alt="Countdown">
          <div class="countdown-timer" id="nature-countdown">15</div>
        </div>
        <div class="quiz-title">Nature & Environment</div>
        <div class="quiz-icon">
          <img src="./imgs/5.png" alt="Nature Icon">
        </div>
      </div>

      <!-- إعادة إضافة فقاعة الكلام لصفحة الطبيعة -->
      <div class="character-speech-container quiz">
        <div class="robot-character"></div>
        <div class="speech-bubble-container">
          <p id="nature-question-text">What does the Sun give us?</p>
        </div>
      </div>

      <div class="question-container">
        <div class="options-container" id="nature-options-container">
          <!-- Options will be populated by JavaScript -->
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="nature-progress-bar"></div>
      </div>
    </div>

    <div class="result-container" id="nature-result-container">
      <div class="result-title" id="nature-result-title">Quiz Completed!</div>
      <div class="result-score" id="nature-result-score">Score: 0/10</div>
      <div class="result-message" id="nature-result-message">Great job! You're a nature expert!</div>
      <button class="restart-button" id="nature-restart-button">Try Again</button>
    </div>

    <div class="navigation-buttons">
      <button class="home-button" aria-label="Home" id="nature-home-btn">
        <img src="./imgs/0.png" alt="Home">
      </button>
      <button class="main-home-button" aria-label="Main Home" id="nature-main-home-btn">
        <img src="./imgs/home.png" alt="Main Home">
      </button>
    </div>
  </div>

  <!-- UZBEKISTAN QUESTIONS PAGE -->
  <div id="uzbekistan-questions-page" class="quiz-page" style="background-image: url('./imgs/11.png'); background-size: cover; background-position: center;">
    <!-- إضافة أيقونات الإجابات الصحيحة والخاطئة -->
    <div class="answer-icon" id="uzbekistan-correct-icon">
      <img src="./imgs/correct.png" alt="Correct">
    </div>
    <div class="answer-icon" id="uzbekistan-wrong-icon">
      <img src="./imgs/wrong.png" alt="Wrong">
    </div>
    
    <div class="quiz-content">
      <div class="quiz-header">
        <div class="countdown-icon">
          <img src="./imgs/countdown.gif" alt="Countdown">
          <div class="countdown-timer" id="uzbekistan-countdown">15</div>
        </div>
        <div class="quiz-title">Uzbekistan Knowledge</div>
        <div class="quiz-icon">
          <img src="./imgs/4.png" alt="Uzbekistan Icon">
        </div>
      </div>

      <!-- إعادة إضافة فقاعة الكلام لصفحة أوزبكستان -->
      <div class="character-speech-container quiz">
        <div class="robot-character"></div>
        <div class="speech-bubble-container">
          <p id="uzbekistan-question-text">How many regions does Uzbekistan have?</p>
        </div>
      </div>

      <div class="question-container">
        <div class="options-container" id="uzbekistan-options-container">
          <!-- Options will be populated by JavaScript -->
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="uzbekistan-progress-bar"></div>
      </div>
    </div>

    <div class="result-container" id="uzbekistan-result-container">
      <div class="result-title" id="uzbekistan-result-title">Quiz Completed!</div>
      <div class="result-score" id="uzbekistan-result-score">Score: 0/10</div>
      <div class="result-message" id="uzbekistan-result-message">Great job! You know Uzbekistan well!</div>
      <button class="restart-button" id="uzbekistan-restart-button">Try Again</button>
    </div>

    <div class="navigation-buttons">
      <button class="home-button" aria-label="Home" id="uzbekistan-home-btn">
        <img src="./imgs/0.png" alt="Home">
      </button>
      <button class="main-home-button" aria-label="Main Home" id="uzbekistan-main-home-btn">
        <img src="./imgs/home.png" alt="Main Home">
      </button>
    </div>
  </div>

  <!-- ANCESTORS QUESTIONS PAGE -->
  <div id="ancestors-questions-page" class="quiz-page" style="background-image: url('./imgs/12.png'); background-size: cover; background-position: center;">
    <!-- إضافة أيقونات الإجابات الصحيحة والخاطئة -->
    <div class="answer-icon" id="ancestors-correct-icon">
      <img src="./imgs/correct.png" alt="Correct">
    </div>
    <div class="answer-icon" id="ancestors-wrong-icon">
      <img src="./imgs/wrong.png" alt="Wrong">
    </div>
    
    <div class="quiz-content">
      <div class="quiz-header">
        <div class="countdown-icon">
          <img src="./imgs/countdown.gif" alt="Countdown">
          <div class="countdown-timer" id="ancestors-countdown">15</div>
        </div>
        <div class="quiz-title">Great Ancestors</div>
        <div class="quiz-icon">
          <img src="./imgs/3.png" alt="Ancestors Icon">
        </div>
      </div>

      <!-- إعادة إضافة فقاعة الكلام لصفحة الأسلاف -->
      <div class="character-speech-container quiz">
        <div class="robot-character"></div>
        <div class="speech-bubble-container">
          <p id="ancestors-question-text">What was Amir Temur's motto?</p>
        </div>
      </div>

      <div class="question-container">
        <div class="options-container" id="ancestors-options-container">
          <!-- Options will be populated by JavaScript -->
        </div>
      </div>

      <div class="progress-container">
        <div class="progress-bar" id="ancestors-progress-bar"></div>
      </div>
    </div>

    <div class="result-container" id="ancestors-result-container">
      <div class="result-title" id="ancestors-result-title">Quiz Completed!</div>
      <div class="result-score" id="ancestors-result-score">Score: 0/10</div>
      <div class="result-message" id="ancestors-result-message">Great job! You know our ancestors well!</div>
      <button class="restart-button" id="ancestors-restart-button">Try Again</button>
    </div>

    <div class="navigation-buttons">
      <button class="home-button" aria-label="Home" id="ancestors-home-btn">
        <img src="./imgs/0.png" alt="Home">
      </button>
      <button class="main-home-button" aria-label="Main Home" id="ancestors-main-home-btn">
        <img src="./imgs/home.png" alt="Main Home">
      </button>
    </div>
  </div>

  <script>
    // ========== SOUND EFFECTS ==========
    // إنشاء عناصر صوتية للتأثيرات الصوتية
    const buttonClickSound = new Audio();
    buttonClickSound.src = "data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA=="; // صوت افتراضي

    // إضافة أصوات الإجابات الصحيحة والخاطئة
    const correctAnswerSound = new Audio('./sounds/Right.mp3');
    const wrongAnswerSound = new Audio('./sounds/wrong.mp3');

    // تعريف الأصوات الأخرى
    const homeSound = new Audio('./sounds/home.mp3');
    const topicsSound = new Audio('./sounds/topics.mp3');

    // متغير لتتبع الصفحة الحالية
    let currentPage = 'holding';

    // دالة مركزية لتشغيل الصوت مع إيقاف أي صوت آخر
    function playSound(audioElement) {
      // إيقاف جميع الأصوات الأخرى قبل تشغيل الصوت الجديد
      [buttonClickSound, correctAnswerSound, wrongAnswerSound, homeSound, topicsSound].forEach(sound => {
        if (sound !== audioElement && !sound.paused) {
          sound.pause();
          sound.currentTime = 0;
        }
      });

      // إعادة تشغيل الصوت من البداية
      audioElement.currentTime = 0;
      audioElement.play().catch(e => console.log('Sound play failed:', e));
    }

    // محاولة تحميل أصوات حقيقية إذا كانت متوفرة
    function loadSoundEffects() {
      // يمكن استبدال هذه بالمقاطع الصوتية الفعلية
      try {
        // صوت نقرة زر عادي
        buttonClickSound.src = './sounds/button-click.mp3';
        buttonClickSound.load();
        
        // تحميل أصوات الإجابات
        correctAnswerSound.load();
        wrongAnswerSound.load();
      } catch (e) {
        console.log('Using default button sound');
      }
    }
    
    // دالة تشغيل صوت النقر
    function playButtonSound() {
      playSound(buttonClickSound);
    }
    
    // دالة تشغيل صوت الإجابة الصحيحة
    function playCorrectSound() {
      // تشغيل الصوت فقط إذا كنا في صفحة أسئلة
      if (currentPage.includes('questions')) {
        playSound(correctAnswerSound);
      }
    }
    
    // دالة تشغيل صوت الإجابة الخاطئة
    function playWrongSound() {
      // تشغيل الصوت فقط إذا كنا في صفحة أسئلة
      if (currentPage.includes('questions')) {
        playSound(wrongAnswerSound);
      }
    }
    
    // دالة إضافة مستمعات الأصوات لجميع الأزرار
    function addSoundToButtons() {
      // جميع الأزرار في الصفحة
      const allButtons = document.querySelectorAll('button, .topic-card, .option-button');
      
      allButtons.forEach(button => {
        // إزالة المستمعين السابقين لمنع التكرار
        button.removeEventListener('click', playButtonSound);
        
        // إضافة صوت button-click.mp3 لأزرار START فقط في الصفحة الأولى
        if (button.id === 'start-btn' || button.id === 'boshlash-btn' || button.id === 'nachat-btn') {
          button.addEventListener('click', playButtonSound);
        }
        
        // إضافة صوت home.mp3 لأزرار Home
        if (button.classList.contains('main-home-button') || button.classList.contains('home-button')) {
          button.addEventListener('click', function() {
            playSound(homeSound);
          });
        }
        
        // إضافة صوت topics.mp3 لبطاقات المواضيع
        if (button.classList.contains('topic-card') || 
            button.textContent.includes('Ancestors') ||
            button.textContent.includes('Uzbekistan') ||
            button.textContent.includes('Nature') ||
            button.textContent.includes('Math')) {
          button.addEventListener('click', function() {
            playSound(topicsSound);
          });
        }
      });
    }
    
    // ========== AUTO-RETURN TIMER ==========
    let inactivityTimer;
    const INACTIVITY_TIMEOUT = 90000; // 90 ثانية

    // ========== دالة إيقاف جميع المؤقتات ==========
    function stopAllTimers() {
        // إيقاف مؤقتات العد التنازلي للأسئلة
        clearInterval(mathCountdownTimer);
        clearInterval(natureCountdownTimer);
        clearInterval(uzbekistanCountdownTimer);
        clearInterval(ancestorsCountdownTimer);
        
        // إيقاف مؤتمر عدم النشاط
        clearTimeout(inactivityTimer);
    }

    // دالة إعادة تعيين المؤقت
    function resetInactivityTimer() {
        clearTimeout(inactivityTimer);
        inactivityTimer = setTimeout(returnToMainScreen, INACTIVITY_TIMEOUT);
    }

    // ========== دالة إعادة تعيين شاملة لجميع الاختبارات ==========
    function hardResetAllQuizzes() {
      // إيقاف جميع المؤقتات أولاً
      stopAllTimers();
      
      // إعادة تعيين جميع المتغيرات
      currentMathQuestions = [];
      currentMathQuestionIndex = 0;
      mathScore = 0;
      
      currentNatureQuestions = [];
      currentNatureQuestionIndex = 0;
      natureScore = 0;
      
      currentUzbekistanQuestions = [];
      currentUzbekistanQuestionIndex = 0;
      uzbekistanScore = 0;
      
      currentAncestorsQuestions = [];
      currentAncestorsQuestionIndex = 0;
      ancestorsScore = 0;
      
      // إعادة تعيين واجهة المستخدم لجميع صفحات الاختبارات
      resetQuizUI('math');
      resetQuizUI('nature');
      resetQuizUI('uzbekistan');
      resetQuizUI('ancestors');
    }

    // ========== دالة إعادة تعيين واجهة المستخدم للاختبارات ==========
    function resetQuizUI(quizType) {
      // إعادة تعيين شريط التقدم
      const progressBar = document.getElementById(`${quizType}-progress-bar`);
      if (progressBar) progressBar.style.width = '0%';
      
      // إعادة تعيين المؤقت
      const countdown = document.getElementById(`${quizType}-countdown`);
      if (countdown) {
        countdown.textContent = '15';
        countdown.classList.remove('warning');
      }
      
      // إخفاء صفحة النتائج
      const resultContainer = document.getElementById(`${quizType}-result-container`);
      if (resultContainer) resultContainer.style.display = 'none';
      
      // إعادة تعيين الأزرار
      const optionsContainer = document.getElementById(`${quizType}-options-container`);
      if (optionsContainer) optionsContainer.innerHTML = '';
      
      // إعادة تعيين نص السؤال
      const questionText = document.getElementById(`${quizType}-question-text`);
      if (questionText) {
        // إعادة تعيين لنص السؤال الافتراضي حسب نوع الاختبار
        switch(quizType) {
          case 'math':
            questionText.textContent = "What is the largest three-digit number?";
            break;
          case 'nature':
            questionText.textContent = "What does the Sun give us?";
            break;
          case 'uzbekistan':
            questionText.textContent = "How many regions does Uzbekistan have?";
            break;
          case 'ancestors':
            questionText.textContent = "What was Amir Temur's motto?";
            break;
        }
      }
      
      // إعادة إظهار العناصر المخفية
      const speechContainer = document.querySelector(`#${quizType}-questions-page .character-speech-container.quiz`);
      if (speechContainer) speechContainer.style.display = 'flex';
      
      const questionContainer = document.querySelector(`#${quizType}-questions-page .question-container`);
      if (questionContainer) questionContainer.style.display = 'flex';
      
      const progressContainer = document.querySelector(`#${quizType}-questions-page .progress-container`);
      if (progressContainer) progressContainer.style.display = 'block';
      
      // إخفاء أيقونات الإجابات
      const correctIcon = document.getElementById(`${quizType}-correct-icon`);
      const wrongIcon = document.getElementById(`${quizType}-wrong-icon`);
      if (correctIcon) correctIcon.style.display = 'none';
      if (wrongIcon) wrongIcon.style.display = 'none';
    }

    // دالة العودة إلى الشاشة الرئيسية
    function returnToMainScreen() {
        // إيقاف جميع المؤقتات
        stopAllTimers();
        
        // إعادة تعيين شاملة لجميع الاختبارات
        hardResetAllQuizzes();
        
        // إخفاء جميع الصفحات وإظهار الشاشة الرئيسية فقط
        document.getElementById('holding-page').style.display = 'flex';
        document.getElementById('knowledge-page').style.display = 'none';
        document.getElementById('math-questions-page').style.display = 'none';
        document.getElementById('nature-questions-page').style.display = 'none';
        document.getElementById('uzbekistan-questions-page').style.display = 'none';
        document.getElementById('ancestors-questions-page').style.display = 'none';
        
        // تحديث الصفحة الحالية
        currentPage = 'holding';
        
        // إعادة تشغيل تغيير اللغات
        startLanguageRotation();
        
        // التمرير إلى الأعلى
        window.scrollTo(0, 0);
        
        // إعادة إضافة الأصوات للأزرار
        onPageChange();
    }

    // إضافة مستمعي الأحداث لتتبع التفاعل
    function setupInactivityTracking() {
        // إعادة تعيين المؤقت عند أي تفاعل
        document.addEventListener('mousemove', resetInactivityTimer);
        document.addEventListener('keypress', resetInactivityTimer);
        document.addEventListener('click', resetInactivityTimer);
        document.addEventListener('touchstart', resetInactivityTimer);
        document.addEventListener('scroll', resetInactivityTimer);
        
        // بدء المؤقت لأول مرة
        resetInactivityTimer();
    }
    
    // ========== إضافة مستمع حدث visibility change ==========
    // هذا يحل المشكلة عندما يغير المستخدم التبويب أو يقلل النافذة
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            // إذا أصبحت الصفحة غير مرئية، أوقف جميع المؤقتات
            stopAllTimers();
        } else {
            // إذا عادت الصفحة للظهور، أعد تشغيل مؤتمر عدم النشاط
            resetInactivityTimer();
        }
    });
    
    // ========== LANGUAGE ROTATION FOR HOLDING PAGE ==========
    const languages = [
      {
        code: 'en',
        title: 'SHARPEN YOUR MIND',
        subtitle: 'ARE YOU READY TO CHALLENGE YOUR BRAIN WITH SOME FUN QUESTIONS?'
      },
      {
        code: 'uz',
        title: 'AQLINGIZNI OʻTKIRLASHTIRING',
        subtitle: 'MIYANGIZNI QIZIQARLI SAVOLLAR BILAN SINAB KOʻRISHGA TAYYORMISIZ?'
      },
      {
        code: 'ru',
        title: 'ОСТРИТЕ СВОЙ УМ',
        subtitle: 'ГОТОВЫ ЛИ ВЫ ИСПЫТАТЬ СВОЙ МОЗГ ИНТЕРЕСНЫМИ ВОПРОСАМИ?'
      }
    ];

    let currentLanguageIndex = 0;
    let languageInterval;

    function startLanguageRotation() {
  // تعيين الفاصل الزمني لتغيير اللغة كل 6 ثوانٍ
  languageInterval = setInterval(() => {
    currentLanguageIndex = (currentLanguageIndex + 1) % languages.length;
    updateLanguageContent();
  }, 6000);
}

    function updateLanguageContent() {
      const currentLang = languages[currentLanguageIndex];
      document.getElementById('title-text').textContent = currentLang.title;
      document.getElementById('subtitle-text').textContent = currentLang.subtitle;
      // تم إزالة تحديث نص الفقاعة
    }

    function stopLanguageRotation() {
      if (languageInterval) {
        clearInterval(languageInterval);
      }
    }

    // بدء تغيير اللغات عند تحميل الصفحة
    window.addEventListener('load', () => {
      loadSoundEffects();
      startLanguageRotation();
      // إخفاء زر الصفحة الرئيسية في صفحة المعرفة فقط
      document.getElementById('home-btn').style.display = 'none';
      
      // إضافة الأصوات لجميع الأزرار بعد تحميل الصفحة
      setTimeout(addSoundToButtons, 1000);
      
      // بدء تتبع عدم النشاط - أضف هذا السطر
      setupInactivityTracking();
    });

    // إعادة إضافة الأصوات عند تغيير الصفحات
    function onPageChange() {
      setTimeout(addSoundToButtons, 100);
      resetInactivityTimer(); // أضف هذا السطر
    }

    // الانتقال إلى صفحة المعرفة
    document.querySelectorAll('#start-btn, #boshlash-btn, #nachat-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        stopLanguageRotation(); // إيقاف تغيير اللغات عند الانتقال
        document.getElementById('holding-page').style.display = 'none';
        document.getElementById('knowledge-page').style.display = 'flex';
        currentPage = 'knowledge';
        window.scrollTo(0, 0);
        onPageChange();
      });
    });

    // اختيار موضوع
    function selectTopic(element, type) {
      // إعادة تعيين أي اختبار سابق قبل البدء باختبار جديد
      hardResetAllQuizzes();
      
      document.querySelectorAll('.topic-card').forEach(card => card.classList.remove('selected'));
      element.classList.add('selected');
      
      setTimeout(() => {
        document.getElementById('knowledge-page').style.display = 'none';
        switch(type) {
          case 'math':
            document.getElementById('math-questions-page').style.display = 'flex';
            currentPage = 'math-questions';
            loadMathQuestion();
            break;
          case 'nature':
            document.getElementById('nature-questions-page').style.display = 'flex';
            currentPage = 'nature-questions';
            loadNatureQuestion();
            break;
          case 'uzbekistan':
            document.getElementById('uzbekistan-questions-page').style.display = 'flex';
            currentPage = 'uzbekistan-questions';
            loadUzbekistanQuestion();
            break;
          case 'ancestors':
            document.getElementById('ancestors-questions-page').style.display = 'flex';
            currentPage = 'ancestors-questions';
            loadAncestorsQuestion();
            break;
        }
        window.scrollTo(0, 0);
        onPageChange();
      }, 500);
    }

    // زر الرجوع إلى صفحة المعرفة - إخفاء هذا الزر في صفحة المعرفة
    document.getElementById('home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('knowledge-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    // زر العودة إلى الصفحة الرئيسية الأولى - إبقاء هذا الزر مرئيًا
    document.getElementById('main-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('knowledge-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    // أزرار العودة من صفحات الاختبارات
    document.getElementById('math-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('math-questions-page').style.display = 'none';
      document.getElementById('knowledge-page').style.display = 'flex';
      currentPage = 'knowledge';
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('math-main-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('math-questions-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('nature-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('nature-questions-page').style.display = 'none';
      document.getElementById('knowledge-page').style.display = 'flex';
      currentPage = 'knowledge';
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('nature-main-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('nature-questions-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('uzbekistan-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('uzbekistan-questions-page').style.display = 'none';
      document.getElementById('knowledge-page').style.display = 'flex';
      currentPage = 'knowledge';
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('uzbekistan-main-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('uzbekistan-questions-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('ancestors-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('ancestors-questions-page').style.display = 'none';
      document.getElementById('knowledge-page').style.display = 'flex';
      currentPage = 'knowledge';
      window.scrollTo(0, 0);
      onPageChange();
    });

    document.getElementById('ancestors-main-home-btn').addEventListener('click', () => {
      stopAllTimers(); // إضافة هذا السطر
      hardResetAllQuizzes();
      document.getElementById('ancestors-questions-page').style.display = 'none';
      document.getElementById('holding-page').style.display = 'flex';
      currentPage = 'holding';
      startLanguageRotation(); // إعادة تشغيل تغيير اللغات عند العودة
      window.scrollTo(0, 0);
      onPageChange();
    });

    // ========== دالة خلط عشوائي للأسئلة ==========
    function shuffleArray(array) {
      const shuffled = [...array];
      for (let i = shuffled.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
      }
      return shuffled;
    }

    // ========== دالة خلط عشوائي للاختيارات مع الحفاظ على الإجابة الصحيحة ==========
    function shuffleOptions(question) {
  const shuffledQuestion = {...question};
  
  // دمج الخيارات مع مؤشراتها الأصلية
  const optionsWithIndices = question.options.map((option, index) => ({
    option,
    originalIndex: index
  }));
  
  // خلط الخيارات
  const shuffledOptions = shuffleArray(optionsWithIndices);
  
  // تحديث الخيارات المخلوطة
  shuffledQuestion.options = shuffledOptions.map(item => item.option);
  
  // إيجاد المؤشر الجديد للإجابة الصحيحة
  const newCorrectIndex = shuffledOptions.findIndex(
    item => item.originalIndex === question.correctAnswer
  );
  
  // تحديث الإجابة الصحيحة للموضع الجديد
  shuffledQuestion.correctAnswer = newCorrectIndex;
  
  return shuffledQuestion;
}
// ========== MATH QUESTIONS ==========
    const mathQuestions = [
      {
        question: "Let's add! What is 8 + 6?",
        options: ["14", "13", "15"],
        correctAnswer: 0
      },
      {
        question: "Let's subtract! What is 9 – 4?",
        options: ["6", "5", "4"],
        correctAnswer: 1
      },
      {
        question: "Let's multiply! What is 7 × 2?",
        options: ["12", "14", "16"],
        correctAnswer: 1
      },
      {
        question: "Let's divide! What is 18 ÷ 3?",
        options: ["6", "5", "4"],
        correctAnswer: 0
      },
      {
        question: "Find the odd number:",
        options: ["24", "19", "10"],
        correctAnswer: 1
      },
      {
        question: "How many days are there in a week?",
        options: ["5", "6", "7"],
        correctAnswer: 2
      },
      {
        question: "What is the smallest two-digit number?",
        options: ["11", "10", "12"],
        correctAnswer: 1
      },
      {
        question: "Let's add! What is 4 + 9?",
        options: ["13", "12", "14"],
        correctAnswer: 0
      },
      {
        question: "Let's multiply! What is 5 × 5?",
        options: ["20", "30", "25"],
        correctAnswer: 2
      },
      {
        question: "2, 4, 6, 8, … What is the next number?",
        options: ["9", "10", "12"],
        correctAnswer: 1
      }
    ];

    // ========== NATURE QUESTIONS ==========
    const natureQuestions = [
      {
        question: "What does the Sun give us?",
        options: ["Heat and light", "Electricity", "Water"],
        correctAnswer: 0
      },
      {
        question: "Which one lives in water?",
        options: ["Bird", "Fish", "Cat"],
        correctAnswer: 1
      },
      {
        question: "Which animal can see well in the dark?",
        options: ["Cow", "Bat", "Rabbit"],
        correctAnswer: 1
      },
      {
        question: "Where do leaves grow?",
        options: ["On trees", "In the soil", "In winter"],
        correctAnswer: 0
      },
      {
        question: "During which season do people wear more clothes?",
        options: ["Spring", "Summer", "Winter"],
        correctAnswer: 2
      },
      {
        question: "Where do animals live?",
        options: ["In airplanes", "In forests", "In cars"],
        correctAnswer: 1
      },
      {
        question: "What do flowers grow from?",
        options: ["Seeds", "Leaves", "Water"],
        correctAnswer: 0
      },
      {
        question: "Why do we need air?",
        options: ["For breathing", "For drinking", "For running"],
        correctAnswer: 0
      },
      {
        question: "In which season does it rain the most?",
        options: ["Spring", "Summer", "Winter"],
        correctAnswer: 0
      },
      {
        question: "What is the purpose of a tree's roots?",
        options: ["To produce leaves", "To attach to the soil<br>and absorb nutrients", "To produce fruit"],
        correctAnswer: 1
      }
    ];

    // ========== UZBEKISTAN QUESTIONS ==========
    const uzbekistanQuestions = [
      {
        question: "How many regions does Uzbekistan have?",
        options: ["14", "12", "13"],
        correctAnswer: 1
      },
      {
        question: "Which river flows through Uzbekistan?",
        options: ["Nile", "Amu Darya", "Danube"],
        correctAnswer: 1
      },
      {
        question: "What is the national currency of Uzbekistan?",
        options: ["Soʻm", "Ruble", "Riyal"],
        correctAnswer: 0
      },
      {
        question: "Where is Uzbekistan located?",
        options: ["North America", "Central Asia", "South Africa"],
        correctAnswer: 1
      },
      {
        question: "In which city is the Kok Saroy Palace located?",
        options: ["Bukhara", "Tashkent", "Qarshi"],
        correctAnswer: 1
      },
      {
        question: "What is Andijan famous for?",
        options: ["Its sea", "Its gardens", "Its mountains"],
        correctAnswer: 1
      },
      {
        question: "How many verses does Uzbekistan's national anthem have?",
        options: ["3", "4", "5"],
        correctAnswer: 1
      },
      {
        question: "What is the official language of Uzbekistan?",
        options: ["Uzbek", "Persian", "Turkmen"],
        correctAnswer: 0
      },
      {
        question: "Where is the 'Hazrati Imam' complex located?",
        options: ["Tashkent", "Khiva", "Urgench"],
        correctAnswer: 0
      },
      {
        question: "In which city is 'Ichan Qal'a' located?",
        options: ["Samarkand", "Khiva", "Fergana"],
        correctAnswer: 1
      }
    ];

    // ========== ANCESTORS QUESTIONS ==========
    const ancestorsQuestions = [
      {
        question: "What was Amir Temur's motto?",
        options: ["Knowledge and power", "Justice and order", "Patience and courage"],
        correctAnswer: 1
      },
      {
        question: "How many languages did Beruni know?",
        options: ["2", "4", "More than 5"],
        correctAnswer: 2
      },
      {
        question: "What kind of works did Alisher Navoi write?",
        options: ["Scientific articles", "Ghazals and rubaiyat<br>(poems and quatrains)", "Epics"],
        correctAnswer: 1
      },
      {
        question: "Where was Ibn Sina born?",
        options: ["Bukhara", "Termez", "Andijan"],
        correctAnswer: 0
      },
      {
        question: "How many years did it take to build Ulughbek's observatory?",
        options: ["1 year", "3 years", "5 years"],
        correctAnswer: 1
      },
      {
        question: "In which century did Al-Khwarizmi live?",
        options: ["9th century", "13th century", "15th century"],
        correctAnswer: 0
      },
      {
        question: "Where is Amir Temur's mausoleum located?",
        options: ["Bukhara", "Samarkand", "Tashkent"],
        correctAnswer: 1
      },
      {
        question: "In which city is the statue of Alisher Navoi located in the city centre?",
        options: ["Termez", "Namangan", "Tashkent"],
        correctAnswer: 2
      },
      {
        question: "From which city did Beruni come?",
        options: ["Khwarazm", "Bukhara", "Samarkand"],
        correctAnswer: 0
      },
      {
        question: "What did Ulughbek mainly study?",
        options: ["Music", "Astronomy", "Medicine"],
        correctAnswer: 1
      }
    ];

    // المتغيرات العامة لكل اختبار
    let currentMathQuestions = [];
    let currentMathQuestionIndex = 0;
    let mathScore = 0;
    
    let currentNatureQuestions = [];
    let currentNatureQuestionIndex = 0;
    let natureScore = 0;
    
    let currentUzbekistanQuestions = [];
    let currentUzbekistanQuestionIndex = 0;
    let uzbekistanScore = 0;
    
    let currentAncestorsQuestions = [];
    let currentAncestorsQuestionIndex = 0;
    let ancestorsScore = 0;

    // مؤقتات العد التنازلي
    let mathCountdownTimer;
    let natureCountdownTimer;
    let uzbekistanCountdownTimer;
    let ancestorsCountdownTimer;

    // دالة محسنة لضبط حجم الخط بناءً على طول النص
    function adjustFontSize(button) {
      const textLength = button.textContent.length;
      
      // إزالة جميع فئات حجم الخط السابقة
      button.classList.remove('medium-text', 'small-text', 'very-small-text');
      
      // تطبيق حجم الخط المناسب بناءً على طول النص
      if (textLength > 25) {
        button.classList.add('very-small-text');
      } else if (textLength > 15) {
        button.classList.add('small-text');
      } else if (textLength > 10) {
        button.classList.add('medium-text');
      }
    }

    // ========== دالة العد التنازلي العامة ==========
    function startCountdown(quizType, questionIndex, correctAnswer) {
      let timeLeft = 15;
      const countdownElement = document.getElementById(`${quizType}-countdown`);
      
      // إعادة تعيين المؤقت السابق إذا كان موجوداً
      clearInterval(window[`${quizType}CountdownTimer`]);
      
      // التحقق مما إذا كانت الصفحة الحالية هي صفحة الأسئلة
      if (!currentPage.includes('questions')) {
        return; // لا تبدأ المؤقت إذا لم نكن في صفحة الأسئلة
      }
      
      // تحديث المؤقت
      window[`${quizType}CountdownTimer`] = setInterval(() => {
        // التحقق مرة أخرى مما إذا كنا لا نزال في صفحة الأسئلة
        if (!currentPage.includes('questions')) {
          clearInterval(window[`${quizType}CountdownTimer`]);
          return;
        }
        
        countdownElement.textContent = timeLeft;
        
        // تغيير اللون عند اقتراب انتهاء الوقت
        if (timeLeft <= 5) {
          countdownElement.classList.add('warning');
        } else {
          countdownElement.classList.remove('warning');
        }
        
        timeLeft--;
        
        // عند انتهاء الوقت
        if (timeLeft < 0) {
          clearInterval(window[`${quizType}CountdownTimer`]);
          // الانتقال التلقائي للسؤال التالي مع عرض الإجابة الصحيحة
          handleTimeout(quizType, questionIndex, correctAnswer);
        }
      }, 1000);
    }

    // دالة التعامل مع انتهاء الوقت
    function handleTimeout(quizType, questionIndex, correctAnswer) {
      const buttons = document.querySelectorAll(`#${quizType}-options-container .option-button`);
      
      // التحقق مما إذا كان السؤال لا يزال نشطًا (لم يتم الإجابة عليه بعد)
      // إذا كانت الأزرار لا تزال قابلة للنقر، فهذا يعني أن الوقت قد انتهى قبل الإجابة
      if (buttons.length > 0 && buttons[0].style.pointerEvents !== 'none') {
        
        // تعطيل جميع الأزرار
        buttons.forEach(button => {
          button.style.pointerEvents = 'none';
        });
        
        // عرض الإجابة الصحيحة
        buttons[correctAnswer].classList.add('correct');
        
        // إظهار أيقونة الخطأ
        const wrongIcon = document.getElementById(`${quizType}-wrong-icon`);
        if (wrongIcon) {
          wrongIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الخاطئة
        playWrongSound();
        
        // الانتظار 3 ثواني قبل الانتقال للسؤال التالي
        setTimeout(() => {
          // إخفاء أيقونة الخطأ
          if (wrongIcon) {
            wrongIcon.style.display = 'none';
          }
          
          // إضافة أنيميشن الخروج للسؤال والإجابات بشكل منفصل
          const speechContainer = document.querySelector(`#${quizType}-questions-page .character-speech-container.quiz`);
          const questionContainer = document.querySelector(`#${quizType}-questions-page .question-container`);
          
          // تطبيق أنيميشن الخروج على فقاعة الكلام (للأعلى)
          speechContainer.classList.add('exit');
          // تطبيق أنيميشن الخروج على الإجابات (للأسفل)
          questionContainer.classList.add('exit');
          
          // بعد انتهاء الأنيميشن (500ms)، تحميل السؤال التالي
          setTimeout(() => {
            // زيادة مؤشر السؤال الحالي
            switch(quizType) {
              case 'math':
                currentMathQuestionIndex++;
                break;
              case 'nature':
                currentNatureQuestionIndex++;
                break;
              case 'uzbekistan':
                currentUzbekistanQuestionIndex++;
                break;
              case 'ancestors':
                currentAncestorsQuestionIndex++;
                break;
            }
            
            // إزالة كلاس الخروج من فقاعة الكلام والإجابات
            speechContainer.classList.remove('exit');
            questionContainer.classList.remove('exit');
            
            // تحميل السؤال التالي
            switch(quizType) {
              case 'math':
                loadMathQuestion();
                break;
              case 'nature':
                loadNatureQuestion();
                break;
              case 'uzbekistan':
                loadUzbekistanQuestion();
                break;
              case 'ancestors':
                loadAncestorsQuestion();
                break;
            }
          }, 500);
        }, 3000);
      }
    }

    
    
    // ========== MATH FUNCTIONS ==========
    function loadMathQuestion() {
      // إذا لم تكن الأسئلة قد تم خلطها بعد، قم بخلطها
      if (currentMathQuestions.length === 0) {
        currentMathQuestions = shuffleArray(mathQuestions);
      }
      
      if (currentMathQuestionIndex >= currentMathQuestions.length) {
        showMathResults();
        return;
      }

      // خلط الاختيارات لكل سؤال مع الحفاظ على الإجابة الصحيحة
      const question = shuffleOptions(currentMathQuestions[currentMathQuestionIndex]);
      
      document.getElementById('math-question-text').textContent = question.question;
      
      const progress = ((currentMathQuestionIndex + 1) / currentMathQuestions.length) * 100;
      document.getElementById('math-progress-bar').style.width = `${progress}%`;
      
      const optionsContainer = document.getElementById('math-options-container');
      optionsContainer.innerHTML = "";
      
      question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.innerHTML = option; // تغيير إلى innerHTML
        adjustFontSize(button);
        button.addEventListener('click', () => checkMathAnswer(index, question.correctAnswer));
        optionsContainer.appendChild(button);
      });
      
      // بدء العد التنازلي
      startCountdown('math', currentMathQuestionIndex, question.correctAnswer);
      
      // إعادة إضافة الأصوات للأزرار الجديدة
      onPageChange();
    }

    function checkMathAnswer(selectedIndex, correctAnswer) {
      // إيقاف العد التنازلي
      clearInterval(window.mathCountdownTimer);
      
      const buttons = document.querySelectorAll('#math-options-container .option-button');
      
      buttons.forEach(button => {
        button.style.pointerEvents = 'none';
      });
      
      if (selectedIndex === correctAnswer) {
        buttons[selectedIndex].classList.add('correct');
        mathScore++;
        
        // إظهار أيقونة الإجابة الصحيحة
        const correctIcon = document.getElementById('math-correct-icon');
        if (correctIcon) {
          correctIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الصحيحة
        playCorrectSound();
      } else {
        buttons[selectedIndex].classList.add('incorrect');
        buttons[correctAnswer].classList.add('correct');
        
        // إظهار أيقونة الإجابة الخاطئة
        const wrongIcon = document.getElementById('math-wrong-icon');
        if (wrongIcon) {
          wrongIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الخاطئة
        playWrongSound();
      }
      
      // الانتظار 3 ثواني قبل بدء أنيميشن الخروج
      setTimeout(() => {
        // إخفاء أيقونات الإجابات
        const correctIcon = document.getElementById('math-correct-icon');
        const wrongIcon = document.getElementById('math-wrong-icon');
        if (correctIcon) correctIcon.style.display = 'none';
        if (wrongIcon) wrongIcon.style.display = 'none';
        
        // إضافة أنيميشن الخروج للسؤال والإجابات بشكل منفصل
        const speechContainer = document.querySelector('#math-questions-page .character-speech-container.quiz');
        const questionContainer = document.querySelector('#math-questions-page .question-container');
        
        // تطبيق أنيميشن الخروج على فقاعة الكلام (للأعلى)
        speechContainer.classList.add('exit');
        // تطبيق أنيميشن الخروج على الإجابات (للأسفل)
        questionContainer.classList.add('exit');
        
        // بعد انتهاء الأنيميشن (500ms)، تحميل السؤال التالي
        setTimeout(() => {
          currentMathQuestionIndex++;
          // إزالة كلاس الخروج من فقاعة الكلام والإجابات
          speechContainer.classList.remove('exit');
          questionContainer.classList.remove('exit');
          loadMathQuestion();
        }, 500);
      }, 3000);
    }

    function showMathResults() {
      // إخفاء فقاعة الكلام وعداد الوقت
      document.querySelector('#math-questions-page .character-speech-container.quiz .speech-bubble-container').style.display = 'none';
      document.querySelector('#math-questions-page .quiz-header .countdown-icon').style.display = 'none';
      
      // إخفاء حاوية الأسئلة وشريط التقدم
      document.querySelector('#math-questions-page .question-container').style.display = 'none';
      document.querySelector('#math-questions-page .progress-container').style.display = 'none';
      
      // إظهار النتائج
      document.getElementById('math-result-container').style.display = 'flex';
      
      const percentage = (mathScore / currentMathQuestions.length) * 100;
      document.getElementById('math-result-score').textContent = `Score: ${mathScore}/${currentMathQuestions.length}`;
      
      let message = "";
      let title = "";
      
      if (percentage >= 90) {
        title = "Math Genius!";
        message = "Wow! You're a math wizard! Your skills are absolutely amazing!";
      } else if (percentage >= 70) {
        title = "Great Job!";
        message = "Excellent work! You have a strong understanding of mathematics!";
      } else if (percentage >= 50) {
        title = "Good Effort!";
        message = "Well done! You have a good foundation, keep practicing to improve!";
      } else {
        title = "Keep Learning!";
        message = "Don't worry! Math takes practice. Keep trying and you'll get better!";
      }
      
      document.getElementById('math-result-title').textContent = title;
      document.getElementById('math-result-message').textContent = message;
      
      // إعادة إضافة الأصوات للأزرار في صفحة النتائج
      onPageChange();
    }

    document.getElementById('math-restart-button').addEventListener('click', () => {
      hardResetAllQuizzes();
      loadMathQuestion();
    });

    // ========== NATURE FUNCTIONS ==========
    function loadNatureQuestion() {
      // إذا لم تكن الأسئلة قد تم خلطها بعد، قم بخلطها
      if (currentNatureQuestions.length === 0) {
        currentNatureQuestions = shuffleArray(natureQuestions);
      }
      
      if (currentNatureQuestionIndex >= currentNatureQuestions.length) {
        showNatureResults();
        return;
      }

      // خلط الاختيارات لكل سؤال مع الحفاظ على الإجابة الصحيحة
      const question = shuffleOptions(currentNatureQuestions[currentNatureQuestionIndex]);
      
      document.getElementById('nature-question-text').textContent = question.question;

      const progress = ((currentNatureQuestionIndex + 1) / currentNatureQuestions.length) * 100;
      document.getElementById('nature-progress-bar').style.width = `${progress}%`;
      
      const optionsContainer = document.getElementById('nature-options-container');
      optionsContainer.innerHTML = "";
      
      question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.innerHTML = option; // تغيير إلى innerHTML
        adjustFontSize(button);
        button.addEventListener('click', () => checkNatureAnswer(index, question.correctAnswer));
        optionsContainer.appendChild(button);
      });
      
      // بدء العد التنازلي
      startCountdown('nature', currentNatureQuestionIndex, question.correctAnswer);
      
      // إعادة إضافة الأصوات للأزرار الجديدة
      onPageChange();
    }

    function checkNatureAnswer(selectedIndex, correctAnswer) {
      // إيقاف العد التنازلي
      clearInterval(window.natureCountdownTimer);
      
      const buttons = document.querySelectorAll('#nature-options-container .option-button');
      
      buttons.forEach(button => {
        button.style.pointerEvents = 'none';
      });
      
      if (selectedIndex === correctAnswer) {
        buttons[selectedIndex].classList.add('correct');
        natureScore++;
        
        // إظهار أيقونة الإجابة الصحيحة
        const correctIcon = document.getElementById('nature-correct-icon');
        if (correctIcon) {
          correctIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الصحيحة
        playCorrectSound();
      } else {
        buttons[selectedIndex].classList.add('incorrect');
        buttons[correctAnswer].classList.add('correct');
        
        // إظهار أيقونة الإجابة الخاطئة
        const wrongIcon = document.getElementById('nature-wrong-icon');
        if (wrongIcon) {
          wrongIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الخاطئة
        playWrongSound();
      }
      
      // الانتظار 3 ثواني قبل بدء أنيميشن الخروج
      setTimeout(() => {
        // إخفاء أيقونات الإجابات
        const correctIcon = document.getElementById('nature-correct-icon');
        const wrongIcon = document.getElementById('nature-wrong-icon');
        if (correctIcon) correctIcon.style.display = 'none';
        if (wrongIcon) wrongIcon.style.display = 'none';
        
        // إضافة أنيميشن الخروج للسؤال والإجابات بشكل منفصل
        const speechContainer = document.querySelector('#nature-questions-page .character-speech-container.quiz');
        const questionContainer = document.querySelector('#nature-questions-page .question-container');
        
        // تطبيق أنيميشن الخروج على فقاعة الكلام (للأعلى)
        speechContainer.classList.add('exit');
        // تطبيق أنيميشن الخروج على الإجابات (للأسفل)
        questionContainer.classList.add('exit');
        
        // بعد انتهاء الأنيميشن (500ms)، تحميل السؤال التالي
        setTimeout(() => {
          currentNatureQuestionIndex++;
          // إزالة كلاس الخروج من فقاعة الكلام والإجابات
          speechContainer.classList.remove('exit');
          questionContainer.classList.remove('exit');
          loadNatureQuestion();
        }, 500);
      }, 3000);
    }

    function showNatureResults() {
      // إخفاء فقاعة الكلام وعداد الوقت
      document.querySelector('#nature-questions-page .character-speech-container.quiz .speech-bubble-container').style.display = 'none';
      document.querySelector('#nature-questions-page .quiz-header .countdown-icon').style.display = 'none';
      
      // إخفاء حاوية الأسئلة وشريط التقدم
      document.querySelector('#nature-questions-page .question-container').style.display = 'none';
      document.querySelector('#nature-questions-page .progress-container').style.display = 'none';
      
      // إظهار النتائج
      document.getElementById('nature-result-container').style.display = 'flex';
      
      const percentage = (natureScore / currentNatureQuestions.length) * 100;
      document.getElementById('nature-result-score').textContent = `Score: ${natureScore}/${currentNatureQuestions.length}`;
      
      let message = "";
      let title = "";
      
      if (percentage >= 90) {
        title = "Nature Expert!";
        message = "Amazing! You're a true nature lover with incredible knowledge!";
      } else if (percentage >= 70) {
        title = "Great Job!";
        message = "Excellent! You have wonderful knowledge about nature and environment!";
      } else if (percentage >= 50) {
        title = "Good Effort!";
        message = "Well done! You care about our planet, keep learning about nature!";
      } else {
        title = "Keep Exploring!";
        message = "Nature is amazing! Keep exploring and learning about our beautiful world!";
      }
      
      document.getElementById('nature-result-title').textContent = title;
      document.getElementById('nature-result-message').textContent = message;
      
      // إعادة إضافة الأصوات للأزرار في صفحة النتائج
      onPageChange();
    }

    document.getElementById('nature-restart-button').addEventListener('click', () => {
      hardResetAllQuizzes();
      loadNatureQuestion();
    });

    // ========== UZBEKISTAN FUNCTIONS ==========
    function loadUzbekistanQuestion() {
      // إذا لم تكن الأسئلة قد تم خلطها بعد، قم بخلطها
      if (currentUzbekistanQuestions.length === 0) {
        currentUzbekistanQuestions = shuffleArray(uzbekistanQuestions);
      }
      
      if (currentUzbekistanQuestionIndex >= currentUzbekistanQuestions.length) {
        showUzbekistanResults();
        return;
      }

      // خلط الاختيارات لكل سؤال مع الحفاظ على الإجابة الصحيحة
      const question = shuffleOptions(currentUzbekistanQuestions[currentUzbekistanQuestionIndex]);
      
      document.getElementById('uzbekistan-question-text').textContent = question.question;
      
      const progress = ((currentUzbekistanQuestionIndex + 1) / currentUzbekistanQuestions.length) * 100;
      document.getElementById('uzbekistan-progress-bar').style.width = `${progress}%`;
      
      const optionsContainer = document.getElementById('uzbekistan-options-container');
      optionsContainer.innerHTML = "";
      
      question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.textContent = option;
        adjustFontSize(button); // ضبط حجم الخط بناءً على طول النص
        button.addEventListener('click', () => checkUzbekistanAnswer(index, question.correctAnswer));
        optionsContainer.appendChild(button);
      });
      
      // بدء العد التنازلي
      startCountdown('uzbekistan', currentUzbekistanQuestionIndex, question.correctAnswer);
      
      // إعادة إضافة الأصوات للأزرار الجديدة
      onPageChange();
    }

    function checkUzbekistanAnswer(selectedIndex, correctAnswer) {
      // إيقاف العد التنازلي
      clearInterval(window.uzbekistanCountdownTimer);
      
      const buttons = document.querySelectorAll('#uzbekistan-options-container .option-button');
      
      buttons.forEach(button => {
        button.style.pointerEvents = 'none';
      });
      
      if (selectedIndex === correctAnswer) {
        buttons[selectedIndex].classList.add('correct');
        uzbekistanScore++;
        
        // إظهار أيقونة الإجابة الصحيحة
        const correctIcon = document.getElementById('uzbekistan-correct-icon');
        if (correctIcon) {
          correctIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الصحيحة
        playCorrectSound();
      } else {
        buttons[selectedIndex].classList.add('incorrect');
        buttons[correctAnswer].classList.add('correct');
        
        // إظهار أيقونة الإجابة الخاطئة
        const wrongIcon = document.getElementById('uzbekistan-wrong-icon');
        if (wrongIcon) {
          wrongIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الخاطئة
        playWrongSound();
      }
      
      // الانتظار 3 ثواني قبل بدء أنيميشن الخروج
      setTimeout(() => {
        // إخفاء أيقونات الإجابات
        const correctIcon = document.getElementById('uzbekistan-correct-icon');
        const wrongIcon = document.getElementById('uzbekistan-wrong-icon');
        if (correctIcon) correctIcon.style.display = 'none';
        if (wrongIcon) wrongIcon.style.display = 'none';
        
        // إضافة أنيميشن الخروج للسؤال والإجابات بشكل منفصل
        const speechContainer = document.querySelector('#uzbekistan-questions-page .character-speech-container.quiz');
        const questionContainer = document.querySelector('#uzbekistan-questions-page .question-container');
        
        // تطبيق أنيميشن الخروج على فقاعة الكلام (للأعلى)
        speechContainer.classList.add('exit');
        // تطبيق أنيميشن الخروج على الإجابات (للأسفل)
        questionContainer.classList.add('exit');
        
        // بعد انتهاء الأنيميشن (500ms)، تحميل السؤال التالي
        setTimeout(() => {
          currentUzbekistanQuestionIndex++;
          // إزالة كلاس الخروج من فقاعة الكلام والإجابات
          speechContainer.classList.remove('exit');
          questionContainer.classList.remove('exit');
          loadUzbekistanQuestion();
        }, 500);
      }, 3000);
    }

    function showUzbekistanResults() {
      // إخفاء فقاعة الكلام وعداد الوقت
      document.querySelector('#uzbekistan-questions-page .character-speech-container.quiz .speech-bubble-container').style.display = 'none';
      document.querySelector('#uzbekistan-questions-page .quiz-header .countdown-icon').style.display = 'none';
      
      // إخفاء حاوية الأسئلة وشريط التقدم
      document.querySelector('#uzbekistan-questions-page .question-container').style.display = 'none';
      document.querySelector('#uzbekistan-questions-page .progress-container').style.display = 'none';
      
      // إظهار النتائج
      document.getElementById('uzbekistan-result-container').style.display = 'flex';
      
      const percentage = (uzbekistanScore / currentUzbekistanQuestions.length) * 100;
      document.getElementById('uzbekistan-result-score').textContent = `Score: ${uzbekistanScore}/${currentUzbekistanQuestions.length}`;
      
      let message = "";
      let title = "";
      
      if (percentage >= 90) {
          title = "Uzbekistan Expert!";
          message = "Incredible! You have excellent knowledge about Uzbekistan's rich culture and history!";
      } else if (percentage >= 70) {
          title = "Great Job!";
          message = "Wonderful! You know Uzbekistan very well!";
      } else if (percentage >= 50) {
          title = "Good Effort!";
          message = "Well done! You're learning about Uzbekistan's amazing heritage!";
      } else {
          title = "Keep Learning!";
          message = "Uzbekistan has a fascinating history and culture! Keep exploring and learning!";
      }
      
      document.getElementById('uzbekistan-result-title').textContent = title;
      document.getElementById('uzbekistan-result-message').textContent = message;
    }

    document.getElementById('uzbekistan-restart-button').addEventListener('click', () => {
      hardResetAllQuizzes();
      loadUzbekistanQuestion();
    });

    // ========== ANCESTORS FUNCTIONS ==========
    function loadAncestorsQuestion() {
      // إذا لم تكن الأسئلة قد تم خلطها بعد، قم بخلطها
      if (currentAncestorsQuestions.length === 0) {
        currentAncestorsQuestions = shuffleArray(ancestorsQuestions);
      }
      
      if (currentAncestorsQuestionIndex >= currentAncestorsQuestions.length) {
        showAncestorsResults();
        return;
      }

      // خلط الاختيارات لكل سؤال مع الحفاظ على الإجابة الصحيحة
      const question = shuffleOptions(currentAncestorsQuestions[currentAncestorsQuestionIndex]);
      
      document.getElementById('ancestors-question-text').textContent = question.question;
      
      const progress = ((currentAncestorsQuestionIndex + 1) / currentAncestorsQuestions.length) * 100;
      document.getElementById('ancestors-progress-bar').style.width = `${progress}%`;
      
      const optionsContainer = document.getElementById('ancestors-options-container');
      optionsContainer.innerHTML = "";
      
      question.options.forEach((option, index) => {
        const button = document.createElement('button');
        button.className = 'option-button';
        button.innerHTML = option; // تغيير من textContent إلى innerHTML
        adjustFontSize(button);
        button.addEventListener('click', () => checkAncestorsAnswer(index, question.correctAnswer));
        optionsContainer.appendChild(button);
      });
      
      // بدء العد التنازلي
      startCountdown('ancestors', currentAncestorsQuestionIndex, question.correctAnswer);
      
      // إعادة إضافة الأصوات للأزرار الجديدة
      onPageChange();
    }

    function checkAncestorsAnswer(selectedIndex, correctAnswer) {
      // إيقاف العد التنازلي
      clearInterval(window.ancestorsCountdownTimer);
      
      const buttons = document.querySelectorAll('#ancestors-options-container .option-button');
      
      buttons.forEach(button => {
        button.style.pointerEvents = 'none';
      });
      
      if (selectedIndex === correctAnswer) {
        buttons[selectedIndex].classList.add('correct');
        ancestorsScore++;
        
        // إظهار أيقونة الإجابة الصحيحة
        const correctIcon = document.getElementById('ancestors-correct-icon');
        if (correctIcon) {
          correctIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الصحيحة
        playCorrectSound();
      } else {
        buttons[selectedIndex].classList.add('incorrect');
        buttons[correctAnswer].classList.add('correct');
        
        // إظهار أيقونة الإجابة الخاطئة
        const wrongIcon = document.getElementById('ancestors-wrong-icon');
        if (wrongIcon) {
          wrongIcon.style.display = 'block';
        }
        
        // تشغيل صوت الإجابة الخاطئة
        playWrongSound();
      }
      
      // الانتظار 3 ثواني قبل بدء أنيميشن الخروج
      setTimeout(() => {
        // إخفاء أيقونات الإجابات
        const correctIcon = document.getElementById('ancestors-correct-icon');
        const wrongIcon = document.getElementById('ancestors-wrong-icon');
        if (correctIcon) correctIcon.style.display = 'none';
        if (wrongIcon) wrongIcon.style.display = 'none';
        
        // إضافة أنيميشن الخروج للسؤال والإجابات بشكل منفصل
        const speechContainer = document.querySelector('#ancestors-questions-page .character-speech-container.quiz');
        const questionContainer = document.querySelector('#ancestors-questions-page .question-container');
        
        // تطبيق أنيميشن الخروج على فقاعة الكلام (للأعلى)
        speechContainer.classList.add('exit');
        // تطبيق أنيميشن الخروج على الإجابات (للأسفل)
        questionContainer.classList.add('exit');
        
        // بعد انتهاء الأنيميشن (500ms)، تحميل السؤال التالي
        setTimeout(() => {
          currentAncestorsQuestionIndex++;
          // إزالة كلاس الخروج من فقاعة الكلام والإجابات
          speechContainer.classList.remove('exit');
          questionContainer.classList.remove('exit');
          loadAncestorsQuestion();
        }, 500);
      }, 3000);
    }

    function showAncestorsResults() {
      // إخفاء فقاعة الكلام وعداد الوقت
      document.querySelector('#ancestors-questions-page .character-speech-container.quiz .speech-bubble-container').style.display = 'none';
      document.querySelector('#ancestors-questions-page .quiz-header .countdown-icon').style.display = 'none';
      
      // إخفاء حاوية الأسئلة وشريط التقدم
      document.querySelector('#ancestors-questions-page .question-container').style.display = 'none';
      document.querySelector('#ancestors-questions-page .progress-container').style.display = 'none';
      
      // إظهار النتائج
      document.getElementById('ancestors-result-container').style.display = 'flex';
      
      const percentage = (ancestorsScore / currentAncestorsQuestions.length) * 100;
      document.getElementById('ancestors-result-score').textContent = `Score: ${ancestorsScore}/${currentAncestorsQuestions.length}`;
      
      let message = "";
      let title = "";
      
      if (percentage >= 90) {
        title = "History Master!";
        message = "Outstanding! You have incredible knowledge about our great ancestors and their achievements!";
      } else if (percentage >= 70) {
        title = "Great Job!";
        message = "Excellent! You respect and understand our ancestors' legacy very well!";
      } else if (percentage >= 50) {
        title = "Good Effort!";
        message = "Well done! You're learning about the amazing people who shaped our world!";
      } else {
        title = "Keep Learning!";
        message = "Our ancestors have amazing stories! Keep exploring and learning from history!";
      }
      
      document.getElementById('ancestors-result-title').textContent = title;
      document.getElementById('ancestors-result-message').textContent = message;
      
      // إعادة إضافة الأصوات للأزرار في صفحة النتائج
      onPageChange();
    }

    document.getElementById('ancestors-restart-button').addEventListener('click', () => {
      hardResetAllQuizzes();
      loadAncestorsQuestion();
    });
  </script>
</body>
</html>
